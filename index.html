<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Floor Check Log</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f6f6f6; margin: 0; padding: 0; }
    .container { max-width: 1100px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    h1 { font-size: 1.6em; margin-bottom: 16px; }
    label { font-weight: bold; display: block; margin-bottom: 8px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px;}
    .locations-row { display: flex; flex-wrap: wrap; gap: 24px; justify-content: flex-start; margin-bottom: 30px;}
    .location-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 110px;
      background: #e9f4fe;
      padding: 14px 8px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      margin-bottom: 0;
    }
    .location-btn {
      padding: 8px 0;
      width: 95px;
      border: none;
      border-radius: 4px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      font-size: 0.98em;
      margin-bottom: 10px;
      transition: background 0.2s;
    }
    .location-btn:active { background: #1565c0; }
    .logs-board {
      margin-top: 38px;
      display: flex;
      flex-direction: row;
      gap: 24px;
      justify-content: flex-start;
      align-items: flex-start;
      overflow-x: auto;
    }
    .logs-column {
      min-width: 110px;
      background: #f3fafe;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      padding: 9px 8px;
      text-align: center;
    }
    .logs-column h4 {
      margin: 0 0 10px 0;
      font-size: 1.02em;
      color: #1976d2;
    }
    .log-entry {
      background: #fff;
      border-radius: 4px;
      padding: 7px 3px;
      margin-bottom: 8px;
      text-align: center;
      font-size: 0.97em;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    .timestamp { color: #888; font-size: 0.92em; }
    .no-log { color: #bbb; font-size: 0.94em; margin: 8px 0;}
    .export-btn { background: #388e3c; margin-top: 18px; }
    .export-btn:active { background: #2e7031; }
    @media (max-width: 900px) {
      .container { max-width: 99vw; }
      .locations-row, .logs-board { gap: 10px; }
      .location-card, .logs-column { min-width: 95px; width: 95px; padding: 8px 2px; }
      .location-btn { width: 80px; font-size: 0.96em;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Floor Check Log</h1>
  <label for="team-member">Team Member</label>
  <input type="text" id="team-member" placeholder="Enter your name..." autocomplete="off">

  <div class="locations-row" id="locations-row"></div>

  <div id="logs-board-container">
    <h3 style="margin-top:32px;">Log for Today</h3>
    <div class="logs-board" id="logs-board"></div>
  </div>

  <button class="export-btn" id="export-btn">Export Log (CSV)</button>
</div>

<script>
const cinemas = ['Vmax', 'Screen X', 'Cinema 3', 'Cinema 4', 'Cinema 5', 'Cinema 6', 'Cinema 7', 'Cinema 8'];
const bathrooms = ['Male bathroom', 'Female bathroom', 'Access bathroom'];
const locations = [...cinemas, ...bathrooms];
const logKey = 'floorCheckLog';

// Load logs from localStorage
function loadLogs() {
  try {
    return JSON.parse(localStorage.getItem(logKey)) || [];
  } catch (e) {
    return [];
  }
}

// Save logs to localStorage
function saveLogs(logs) {
  localStorage.setItem(logKey, JSON.stringify(logs));
}

// Get logs for today only
function getLogsForToday() {
  const logs = loadLogs();
  const today = new Date().toISOString().slice(0, 10);
  return logs.filter(l => l.iso.slice(0, 10) === today);
}

// Add a log entry
function addLogEntry(name, location) {
  const now = new Date();
  const logEntry = {
    name,
    location,
    timestamp: now.toLocaleString(),
    iso: now.toISOString()
  };
  const logs = loadLogs();
  logs.unshift(logEntry); // newest on top
  saveLogs(logs);
  renderLogsBoard();
}

// Render the row of location buttons
function renderLocationButtons() {
  const row = document.getElementById('locations-row');
  row.innerHTML = '';
  locations.forEach(loc => {
    const card = document.createElement('div');
    card.className = 'location-card';

    const btn = document.createElement('button');
    btn.className = 'location-btn';
    btn.textContent = loc;
    btn.onclick = () => {
      const name = document.getElementById('team-member').value.trim();
      if (!name) {
        alert('Please enter your name.');
        return;
      }
      addLogEntry(name, loc);
    };

    card.appendChild(btn);
    row.appendChild(card);
  });
}

// Render the horizontal logs board under the buttons
function renderLogsBoard() {
  const logsBoard = document.getElementById('logs-board');
  logsBoard.innerHTML = '';
  const todayLogs = getLogsForToday();

  locations.forEach(loc => {
    const col = document.createElement('div');
    col.className = 'logs-column';
    // Column header - location name
    const header = document.createElement('h4');
    header.textContent = loc;
    col.appendChild(header);

    // Add all logs for this location today
    const logsForLoc = todayLogs.filter(entry => entry.location === loc);
    if (logsForLoc.length === 0) {
      const noLog = document.createElement('div');
      noLog.className = 'no-log';
      noLog.textContent = 'No entries';
      col.appendChild(noLog);
    } else {
      logsForLoc.forEach(entry => {
        const logDiv = document.createElement('div');
        logDiv.className = 'log-entry';
        logDiv.innerHTML = `<strong>${entry.name}</strong><br>
          <span class="timestamp">${entry.timestamp}</span>`;
        col.appendChild(logDiv);
      });
    }
    logsBoard.appendChild(col);
  });
}

// Export log as CSV
function exportLogCSV() {
  const logs = loadLogs();
  if (logs.length === 0) {
    alert('No log entries to export.');
    return;
  }
  const header = ['Name', 'Location', 'Timestamp (local)', 'Timestamp (ISO)'];
  const rows = logs.map(l => [l.name, l.location, l.timestamp, l.iso]);
  const csv = [header, ...rows].map(row => row.map(val => `"${val.replace(/"/g, '""')}"`).join(',')).join('\n');

  // Download as CSV
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `floor_check_log_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Setup
renderLocationButtons();
renderLogsBoard();
document.getElementById('export-btn').onclick = exportLogCSV;
</script>
</body>
</html>
