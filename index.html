<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Floor Check Log</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f6f6f6; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    h1 { font-size: 1.6em; margin-bottom: 16px; }
    label { font-weight: bold; display: block; margin-bottom: 8px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px;}
    .locations-row { display: flex; flex-wrap: wrap; gap: 24px; justify-content: flex-start; margin-bottom: 30px;}
    .location-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 110px;
      background: #e9f4fe;
      padding: 14px 8px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      margin-bottom: 0;
    }
    .location-btn {
      padding: 8px 0;
      width: 95px;
      border: none;
      border-radius: 4px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      font-size: 0.98em;
      margin-bottom: 10px;
      transition: background 0.2s;
    }
    .location-btn:active { background: #1565c0; }
    .log-entry {
      background: #fff;
      border-radius: 4px;
      padding: 8px;
      width: 100%;
      text-align: center;
      font-size: 0.95em;
      margin-bottom: 2px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    .timestamp { color: #888; font-size: 0.92em; }
    .export-btn { background: #388e3c; margin-top: 18px; }
    .export-btn:active { background: #2e7031; }
  </style>
</head>
<body>
<div class="container">
  <h1>Floor Check Log</h1>
  <label for="team-member">Team Member</label>
  <input type="text" id="team-member" placeholder="Enter your name..." autocomplete="off">

  <div class="locations-row" id="locations-row"></div>

  <button class="export-btn" id="export-btn">Export Log (CSV)</button>
</div>

<script>
const cinemas = ['Vmax', 'Screen X', 'Cinema 3', 'Cinema 4', 'Cinema 5', 'Cinema 6', 'Cinema 7', 'Cinema 8'];
const bathrooms = ['Male bathroom', 'Female bathroom', 'Access bathroom'];
const locations = [...cinemas, ...bathrooms];
const logKey = 'floorCheckLog';

// Load logs from localStorage
function loadLogs() {
  try {
    return JSON.parse(localStorage.getItem(logKey)) || [];
  } catch (e) {
    return [];
  }
}

// Save logs to localStorage
function saveLogs(logs) {
  localStorage.setItem(logKey, JSON.stringify(logs));
}

// Add a log entry
function addLogEntry(name, location) {
  const now = new Date();
  const logEntry = {
    name,
    location,
    timestamp: now.toLocaleString(),
    iso: now.toISOString()
  };
  const logs = loadLogs();
  logs.unshift(logEntry); // newest on top
  saveLogs(logs);
  renderLocationLogs();
}

// Render the row of location buttons and latest logs
function renderLocationLogs() {
  const logs = loadLogs();
  const row = document.getElementById('locations-row');
  row.innerHTML = '';

  locations.forEach(loc => {
    // Find most recent log for this location
    const latestLog = logs.find(entry => entry.location === loc);
    // Create card
    const card = document.createElement('div');
    card.className = 'location-card';

    // Location button
    const btn = document.createElement('button');
    btn.className = 'location-btn';
    btn.textContent = loc;
    btn.onclick = () => {
      const name = document.getElementById('team-member').value.trim();
      if (!name) {
        alert('Please enter your name.');
        return;
      }
      addLogEntry(name, loc);
    };

    card.appendChild(btn);

    // Log display
    const logDiv = document.createElement('div');
    logDiv.className = 'log-entry';
    if (latestLog) {
      logDiv.innerHTML = `<strong>${latestLog.name}</strong><br>
        <span class="timestamp">${latestLog.timestamp}</span>`;
    } else {
      logDiv.innerHTML = `<span style="color:#888;">No check yet</span>`;
    }
    card.appendChild(logDiv);

    row.appendChild(card);
  });
}

// Export log as CSV
function exportLogCSV() {
  const logs = loadLogs();
  if (logs.length === 0) {
    alert('No log entries to export.');
    return;
  }
  const header = ['Name', 'Location', 'Timestamp (local)', 'Timestamp (ISO)'];
  const rows = logs.map(l => [l.name, l.location, l.timestamp, l.iso]);
  const csv = [header, ...rows].map(row => row.map(val => `"${val.replace(/"/g, '""')}"`).join(',')).join('\n');

  // Download as CSV
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `floor_check_log_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Setup
renderLocationLogs();
document.getElementById('export-btn').onclick = exportLogCSV;
</script>
</body>
</html>
